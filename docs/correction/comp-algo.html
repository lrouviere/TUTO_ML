<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapitre 8 Comparaison d’algorithmes | Machine learning</title>
  <meta name="description" content="Chapitre 8 Comparaison d’algorithmes | Machine learning" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapitre 8 Comparaison d’algorithmes | Machine learning" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapitre 8 Comparaison d’algorithmes | Machine learning" />
  
  
  

<meta name="author" content="Laurent Rouvière" />


<meta name="date" content="2021-01-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dondes.html"/>
<link rel="next" href="références.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.2/htmlwidgets.js"></script>
<link href="libs/vis-4.20.1/vis.css" rel="stylesheet" />
<script src="libs/vis-4.20.1/vis.min.js"></script>
<script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script>
<script src="libs/FileSaver-1.1.20151003/FileSaver.min.js"></script>
<script src="libs/Blob-1.0/Blob.js"></script>
<script src="libs/canvas-toBlob-1.0/canvas-toBlob.js"></script>
<script src="libs/html2canvas-0.5.0/html2canvas.js"></script>
<script src="libs/jspdf-1.3.2/jspdf.debug.js"></script>
<link href="libs/jquery-sparkline-2.1.2/jquery.sparkline.css" rel="stylesheet" />
<script src="libs/jquery-sparkline-2.1.2/jquery.sparkline.js"></script>
<script src="libs/sparkline-binding-2.0/sparkline.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Machine Learning<br> <br> L. Rouvière</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Présentation</a></li>
<li class="part"><span><b>I Algorithmes de référence</b></span></li>
<li class="chapter" data-level="1" data-path="caret.html"><a href="caret.html"><i class="fa fa-check"></i><b>1</b> Estimation du risque avec caret</a><ul>
<li class="chapter" data-level="1.1" data-path="caret.html"><a href="caret.html#notion-de-risque-en-apprentissage-supervisé"><i class="fa fa-check"></i><b>1.1</b> Notion de risque en apprentissage supervisé</a></li>
<li class="chapter" data-level="1.2" data-path="caret.html"><a href="caret.html#la-validation-croisée"><i class="fa fa-check"></i><b>1.2</b> La validation croisée</a></li>
<li class="chapter" data-level="1.3" data-path="caret.html"><a href="caret.html#le-package-caret"><i class="fa fa-check"></i><b>1.3</b> Le package caret</a></li>
<li class="chapter" data-level="1.4" data-path="caret.html"><a href="caret.html#la-courbe-roc"><i class="fa fa-check"></i><b>1.4</b> La courbe ROC</a></li>
<li class="chapter" data-level="1.5" data-path="caret.html"><a href="caret.html#compléments"><i class="fa fa-check"></i><b>1.5</b> Compléments</a><ul>
<li class="chapter" data-level="1.5.1" data-path="caret.html"><a href="caret.html#calcul-parallèle"><i class="fa fa-check"></i><b>1.5.1</b> Calcul parallèle</a></li>
<li class="chapter" data-level="1.5.2" data-path="caret.html"><a href="caret.html#répéter-les-méthodes-de-rééchantillonnage"><i class="fa fa-check"></i><b>1.5.2</b> Répéter les méthodes de rééchantillonnage</a></li>
<li class="chapter" data-level="1.5.3" data-path="caret.html"><a href="caret.html#modifier-le-risque"><i class="fa fa-check"></i><b>1.5.3</b> Modifier le risque</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="lda.html"><a href="lda.html"><i class="fa fa-check"></i><b>2</b> Analyse discriminante linéaire</a><ul>
<li class="chapter" data-level="2.1" data-path="lda.html"><a href="lda.html#prise-en-main-lda-et-qda-sur-les-iris-de-fisher"><i class="fa fa-check"></i><b>2.1</b> Prise en main : LDA et QDA sur les iris de Fisher</a></li>
<li class="chapter" data-level="2.2" data-path="lda.html"><a href="lda.html#un-cas-avec-beaucoup-de-classes"><i class="fa fa-check"></i><b>2.2</b> Un cas avec beaucoup de classes</a></li>
<li class="chapter" data-level="2.3" data-path="lda.html"><a href="lda.html#grande-dimension-reconnaissance-de-phonèmes"><i class="fa fa-check"></i><b>2.3</b> Grande dimension : reconnaissance de phonèmes</a></li>
<li class="chapter" data-level="2.4" data-path="lda.html"><a href="lda.html#exercices"><i class="fa fa-check"></i><b>2.4</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="arbres.html"><a href="arbres.html"><i class="fa fa-check"></i><b>3</b> Arbres</a><ul>
<li class="chapter" data-level="3.1" data-path="arbres.html"><a href="arbres.html#coupures-cart-en-fonction-de-la-nature-des-variables"><i class="fa fa-check"></i><b>3.1</b> Coupures CART en fonction de la nature des variables</a><ul>
<li class="chapter" data-level="3.1.1" data-path="arbres.html"><a href="arbres.html#arbres-de-régression"><i class="fa fa-check"></i><b>3.1.1</b> Arbres de régression</a></li>
<li class="chapter" data-level="3.1.2" data-path="arbres.html"><a href="arbres.html#arbres-de-classification"><i class="fa fa-check"></i><b>3.1.2</b> Arbres de classification</a></li>
<li class="chapter" data-level="3.1.3" data-path="arbres.html"><a href="arbres.html#entrée-qualitative"><i class="fa fa-check"></i><b>3.1.3</b> Entrée qualitative</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="arbres.html"><a href="arbres.html#élagage"><i class="fa fa-check"></i><b>3.2</b> Élagage</a><ul>
<li class="chapter" data-level="3.2.1" data-path="arbres.html"><a href="arbres.html#élagage-pour-un-problème-de-régression"><i class="fa fa-check"></i><b>3.2.1</b> Élagage pour un problème de régression</a></li>
<li class="chapter" data-level="3.2.2" data-path="arbres.html"><a href="arbres.html#élagage-en-classification-binaire-et-matrice-de-coût"><i class="fa fa-check"></i><b>3.2.2</b> Élagage en classification binaire et matrice de coût</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Algorithmes avancés</b></span></li>
<li class="chapter" data-level="4" data-path="SVM.html"><a href="SVM.html"><i class="fa fa-check"></i><b>4</b> Support Vector Machine (SVM)</a><ul>
<li class="chapter" data-level="4.1" data-path="SVM.html"><a href="SVM.html#cas-séparable"><i class="fa fa-check"></i><b>4.1</b> Cas séparable</a></li>
<li class="chapter" data-level="4.2" data-path="SVM.html"><a href="SVM.html#cas-non-séparable"><i class="fa fa-check"></i><b>4.2</b> Cas non séparable</a></li>
<li class="chapter" data-level="4.3" data-path="SVM.html"><a href="SVM.html#lastuce-du-noyau"><i class="fa fa-check"></i><b>4.3</b> L’astuce du noyau</a></li>
<li class="chapter" data-level="4.4" data-path="SVM.html"><a href="SVM.html#support-vector-régression"><i class="fa fa-check"></i><b>4.4</b> Support vector régression</a></li>
<li class="chapter" data-level="4.5" data-path="SVM.html"><a href="SVM.html#svm-sur-les-données-spam"><i class="fa fa-check"></i><b>4.5</b> SVM sur les données spam</a></li>
<li class="chapter" data-level="4.6" data-path="SVM.html"><a href="SVM.html#exercices-1"><i class="fa fa-check"></i><b>4.6</b> Exercices</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="agregation.html"><a href="agregation.html"><i class="fa fa-check"></i><b>5</b> Agrégation : forêts aléatoires et gradient boosting</a><ul>
<li class="chapter" data-level="5.1" data-path="agregation.html"><a href="agregation.html#forets"><i class="fa fa-check"></i><b>5.1</b> Forêts aléatoires</a></li>
<li class="chapter" data-level="5.2" data-path="agregation.html"><a href="agregation.html#boosting"><i class="fa fa-check"></i><b>5.2</b> Gradient boosting</a><ul>
<li class="chapter" data-level="5.2.1" data-path="agregation.html"><a href="agregation.html#un-exemple-simple-en-régression"><i class="fa fa-check"></i><b>5.2.1</b> Un exemple simple en régression</a></li>
<li class="chapter" data-level="5.2.2" data-path="agregation.html"><a href="agregation.html#adaboost-et-logitboost-pour-la-classification-binaire."><i class="fa fa-check"></i><b>5.2.2</b> Adaboost et logitboost pour la classification binaire.</a></li>
<li class="chapter" data-level="5.2.3" data-path="agregation.html"><a href="agregation.html#exo:grad-boost"><i class="fa fa-check"></i><b>5.2.3</b> Exercices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="deep.html"><a href="deep.html"><i class="fa fa-check"></i><b>6</b> Réseaux de neurones avec Keras</a></li>
<li class="chapter" data-level="7" data-path="dondes.html"><a href="dondes.html"><i class="fa fa-check"></i><b>7</b> Données déséquilibrées</a><ul>
<li class="chapter" data-level="7.1" data-path="dondes.html"><a href="dondes.html#critères-de-performance-pour-données-déséquilibrées"><i class="fa fa-check"></i><b>7.1</b> Critères de performance pour données déséquilibrées</a></li>
<li class="chapter" data-level="7.2" data-path="dondes.html"><a href="dondes.html#ré-équilibrage"><i class="fa fa-check"></i><b>7.2</b> Ré-équilibrage</a></li>
<li class="chapter" data-level="7.3" data-path="dondes.html"><a href="dondes.html#exercices-supplémentaires"><i class="fa fa-check"></i><b>7.3</b> Exercices supplémentaires</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="comp-algo.html"><a href="comp-algo.html"><i class="fa fa-check"></i><b>8</b> Comparaison d’algorithmes</a></li>
<li class="chapter" data-level="" data-path="références.html"><a href="références.html"><i class="fa fa-check"></i>Références</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Machine learning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="comp-algo" class="section level1">
<h1><span class="header-section-number">Chapitre 8</span> Comparaison d’algorithmes</h1>
<p>Les chapitres précédents ont présenté plusieurs algorithmes permettant de répondre à un problème posé, le plus souvent de classification supervisée. Se pose bien entendu la question de choisir un unique algorithme. Etant donné un échantillon <span class="math inline">\(\mathcal D_n=\{(x_1,y_1),\dots,(x_n,y_y)\}\)</span> on rappelle qu’un algorithme de prévision est une fonction
<span class="math display">\[g:\mathcal X\times(\mathcal X\times \mathcal Y)^n\to\mathcal Y\]</span>
qui, à une nouvelle observation <span class="math inline">\(x\in\mathcal X\)</span> renverra la prévision <span class="math inline">\(g(x,\mathcal D_n)\)</span> calculée à partir de l’échantillon <span class="math inline">\(\mathcal D_n\)</span>. Cette fonction <span class="math inline">\(g\)</span> peut contenir tout un tas d’étapes comme :</p>
<ul>
<li>la gestion des données manquantes</li>
<li>une procédure de choix de variables</li>
<li>une méthode pour ré-équilibrer les données</li>
<li>des procédures pour calibrer des paramètres (qui peuvent éventuellement inclure des validations croisées)</li>
<li>…</li>
</ul>
<p>Le machine learning se focalisant sur la capacité d’un algorithme à bien prédire, les stratégies classiques pour choisir un algorithme vont (une fois de plus) consister à évaluer le pouvoir prédictif de chaque algorithme. Il n’y a rien de bien nouveau puisque cela va reposer sur les techniques présentées aux chapitres <a href="caret.html#caret">1</a> :</p>
<ul>
<li>choisir un ou plusieurs critères (erreur de classification, AUC, <span class="math inline">\(F_1\)</span>-score…)</li>
<li>choisir une procédure de ré-échantillonnage pour estimer ce critère (validation hold-out, validation croisée, OOB…).</li>
</ul>
<p>Nous proposons de développer une stratégie pour choisir un algorithme sur le jeu de données <strong>Internet Advertisements Data Set</strong> disponible sur cette page <a href="https://archive.ics.uci.edu/ml/datasets/internet+advertisements" class="uri">https://archive.ics.uci.edu/ml/datasets/internet+advertisements</a>. Le problème est d’identifier la présence d’une image publicitaire sur des pages webs. Il comporte</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="comp-algo.html#cb263-1"></a>ad.data &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;data/ad_data.txt&quot;</span>,<span class="dt">header=</span><span class="ot">FALSE</span>,<span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,<span class="dt">dec=</span><span class="st">&quot;.&quot;</span>,<span class="dt">na.strings =</span> <span class="st">&quot;?&quot;</span>,<span class="dt">strip.white =</span> <span class="ot">TRUE</span>)</span>
<span id="cb263-2"><a href="comp-algo.html#cb263-2"></a><span class="kw">dim</span>(ad.data)</span>
<span id="cb263-3"><a href="comp-algo.html#cb263-3"></a>[<span class="dv">1</span>] <span class="dv">3279</span> <span class="dv">1559</span></span></code></pre></div>
<p>Ce jeu de données contient 1558 variables explicatives, ces variables contiennent différentes caractériques de la page web (voir le site où sont présentées les données pour plus d’information). La dernière variable est la variable à expliquer, elle vaut <code>ad.</code> si présence d’une publicité, <code>nonad.</code> sinon.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="comp-algo.html#cb264-1"></a><span class="kw">names</span>(ad.data)[<span class="kw">ncol</span>(ad.data)] &lt;-<span class="st"> &quot;Y&quot;</span></span>
<span id="cb264-2"><a href="comp-algo.html#cb264-2"></a>ad.data<span class="op">$</span>Y &lt;-<span class="st"> </span><span class="kw">as.factor</span>(ad.data<span class="op">$</span>Y)</span>
<span id="cb264-3"><a href="comp-algo.html#cb264-3"></a><span class="kw">summary</span>(ad.data<span class="op">$</span>Y)</span>
<span id="cb264-4"><a href="comp-algo.html#cb264-4"></a>   ad. nonad. </span>
<span id="cb264-5"><a href="comp-algo.html#cb264-5"></a>   <span class="dv">459</span>   <span class="dv">2820</span> </span></code></pre></div>
<p>Ce jeu de données contient des données manquantes.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="comp-algo.html#cb265-1"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(ad.data))</span>
<span id="cb265-2"><a href="comp-algo.html#cb265-2"></a>[<span class="dv">1</span>] <span class="dv">2729</span></span></code></pre></div>
<p>On remarque que :</p>
<ul>
<li>920 lignes</li>
<li>4 colonnes</li>
</ul>
<p>ont au moins une valeur manquante.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="comp-algo.html#cb266-1"></a><span class="kw">apply</span>(<span class="kw">is.na</span>(ad.data),<span class="dv">1</span>,any) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</span>
<span id="cb266-2"><a href="comp-algo.html#cb266-2"></a>[<span class="dv">1</span>] <span class="dv">920</span></span>
<span id="cb266-3"><a href="comp-algo.html#cb266-3"></a>var.na &lt;-<span class="st"> </span><span class="kw">apply</span>(<span class="kw">is.na</span>(ad.data),<span class="dv">2</span>,any)</span>
<span id="cb266-4"><a href="comp-algo.html#cb266-4"></a><span class="kw">names</span>(ad.data)[var.na]</span>
<span id="cb266-5"><a href="comp-algo.html#cb266-5"></a>[<span class="dv">1</span>] <span class="st">&quot;V1&quot;</span> <span class="st">&quot;V2&quot;</span> <span class="st">&quot;V3&quot;</span> <span class="st">&quot;V4&quot;</span></span></code></pre></div>
<p>On choisit de retirer ces 4 variables de l’analyse (il faudrait peut-être réfléchir un peu plus…).</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="comp-algo.html#cb267-1"></a>ad.data1 &lt;-<span class="st"> </span>ad.data[,var.na<span class="op">==</span><span class="ot">FALSE</span>]</span>
<span id="cb267-2"><a href="comp-algo.html#cb267-2"></a><span class="kw">dim</span>(ad.data1)</span>
<span id="cb267-3"><a href="comp-algo.html#cb267-3"></a>[<span class="dv">1</span>] <span class="dv">3279</span> <span class="dv">1555</span></span>
<span id="cb267-4"><a href="comp-algo.html#cb267-4"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(ad.data1))</span>
<span id="cb267-5"><a href="comp-algo.html#cb267-5"></a>[<span class="dv">1</span>] <span class="dv">0</span></span></code></pre></div>
<p>On se retrouve donc en présence de 3279 individus et 1554 variables explicatives. On construit la matrice des <code>X</code> et le vecteur des <code>Y</code> qui sont nécessaires pour certaines fonctions comme <code>glmnet</code> :</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="comp-algo.html#cb268-1"></a>X.ad &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>ad.data1)[,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb268-2"><a href="comp-algo.html#cb268-2"></a>Y.ad &lt;-<span class="st"> </span>ad.data1<span class="op">$</span>Y</span></code></pre></div>
<p>et on transforme la variable cible en 0-1 pour utiliser <code>gbm</code>:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="comp-algo.html#cb269-1"></a>ad.data2 &lt;-<span class="st"> </span>ad.data1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Y=</span><span class="kw">recode</span>(Y,<span class="st">&quot;ad.&quot;</span>=<span class="dv">0</span>,<span class="st">&quot;nonad.&quot;</span>=<span class="dv">1</span>))</span></code></pre></div>
<p>On souhaite comparer les algorithmes présentés précédemment. Ils nécessitent les packages suivants</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="comp-algo.html#cb270-1"></a><span class="kw">library</span>(e1071)</span>
<span id="cb270-2"><a href="comp-algo.html#cb270-2"></a><span class="kw">library</span>(caret)</span>
<span id="cb270-3"><a href="comp-algo.html#cb270-3"></a><span class="kw">library</span>(rpart)</span>
<span id="cb270-4"><a href="comp-algo.html#cb270-4"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb270-5"><a href="comp-algo.html#cb270-5"></a><span class="kw">library</span>(ranger)</span>
<span id="cb270-6"><a href="comp-algo.html#cb270-6"></a><span class="kw">library</span>(gbm)</span></code></pre></div>
<p>On commence tout d’abord par représenter un algorithme par une fonction <strong>R</strong> qui admettra en entrée un jeu de données et renverra une unique prévision pour de nouveaux individus. On illustre ces fonctions pour prédire ce nouvel individu.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="comp-algo.html#cb271-1"></a>newX &lt;-<span class="st"> </span>ad.data1[<span class="dv">1000</span>,]</span>
<span id="cb271-2"><a href="comp-algo.html#cb271-2"></a>newX.X &lt;-<span class="st"> </span><span class="kw">matrix</span>(X.ad[<span class="dv">1000</span>,],<span class="dt">nrow=</span><span class="dv">1</span>)</span></code></pre></div>
<p>On stockera les prévisions dans l’objet suivant</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="comp-algo.html#cb272-1"></a>prev &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">algo=</span><span class="kw">c</span>(<span class="st">&quot;SVM&quot;</span>,<span class="st">&quot;arbre&quot;</span>,<span class="st">&quot;ridge&quot;</span>,<span class="st">&quot;lasso&quot;</span>,<span class="st">&quot;foret&quot;</span>,<span class="st">&quot;ada&quot;</span>,<span class="st">&quot;logit&quot;</span>),<span class="dt">prev=</span><span class="dv">0</span>)</span></code></pre></div>
<ul>
<li><p><strong>SVM</strong> à noyau gaussien où le choix des paramètres du noyau se fait par validation croisée 4 blocs :</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="comp-algo.html#cb273-1"></a>prev.svm &lt;-<span class="st"> </span><span class="cf">function</span>(df,newX){</span>
<span id="cb273-2"><a href="comp-algo.html#cb273-2"></a>  C &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.01</span>,<span class="dv">1</span>,<span class="dv">10</span>)</span>
<span id="cb273-3"><a href="comp-algo.html#cb273-3"></a>  sigma &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">3</span>)</span>
<span id="cb273-4"><a href="comp-algo.html#cb273-4"></a>  gr &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">C=</span>C,<span class="dt">sigma=</span>sigma)</span>
<span id="cb273-5"><a href="comp-algo.html#cb273-5"></a>  ctrl &lt;-<span class="st"> </span><span class="kw">trainControl</span>(<span class="dt">method=</span><span class="st">&quot;cv&quot;</span>,<span class="dt">number=</span><span class="dv">4</span>)</span>
<span id="cb273-6"><a href="comp-algo.html#cb273-6"></a>  cl &lt;-<span class="st"> </span><span class="kw">makePSOCKcluster</span>(<span class="dv">3</span>)</span>
<span id="cb273-7"><a href="comp-algo.html#cb273-7"></a>  <span class="kw">registerDoParallel</span>(cl)</span>
<span id="cb273-8"><a href="comp-algo.html#cb273-8"></a>  res.svm &lt;-<span class="st"> </span><span class="kw">train</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df,<span class="dt">method=</span><span class="st">&quot;svmRadial&quot;</span>,<span class="dt">trControl=</span>ctrl,</span>
<span id="cb273-9"><a href="comp-algo.html#cb273-9"></a>               <span class="dt">tuneGrid=</span>gr,<span class="dt">prob.model=</span><span class="ot">TRUE</span>)</span>
<span id="cb273-10"><a href="comp-algo.html#cb273-10"></a>  <span class="kw">stopCluster</span>(cl)</span>
<span id="cb273-11"><a href="comp-algo.html#cb273-11"></a>  <span class="kw">predict</span>(res.svm,newX,<span class="dt">type=</span><span class="st">&quot;prob&quot;</span>)[<span class="dv">2</span>]</span>
<span id="cb273-12"><a href="comp-algo.html#cb273-12"></a>}</span>
<span id="cb273-13"><a href="comp-algo.html#cb273-13"></a>prev[<span class="dv">1</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.svm</span>(ad.data1,newX)</span></code></pre></div></li>
<li><p><strong>Arbre de classification</strong> où l’élagage est fait selon la procédure <strong>CART</strong> présentée dans le chapitre <a href="arbres.html#arbres">3</a>.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="comp-algo.html#cb274-1"></a>prev.arbre &lt;-<span class="st"> </span><span class="cf">function</span>(df,newX){</span>
<span id="cb274-2"><a href="comp-algo.html#cb274-2"></a>  arbre &lt;-<span class="st"> </span><span class="kw">rpart</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df,<span class="dt">cp=</span><span class="fl">1e-8</span>,<span class="dt">minsplit=</span><span class="dv">2</span>)</span>
<span id="cb274-3"><a href="comp-algo.html#cb274-3"></a>  cp_opt &lt;-<span class="st"> </span>arbre<span class="op">$</span>cptable <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(xerror<span class="op">==</span><span class="kw">min</span>(xerror)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb274-4"><a href="comp-algo.html#cb274-4"></a>dplyr<span class="op">::</span><span class="kw">select</span>(CP) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>()</span>
<span id="cb274-5"><a href="comp-algo.html#cb274-5"></a>  arbre.opt &lt;-<span class="st"> </span><span class="kw">prune</span>(arbre,<span class="dt">cp=</span>cp_opt)</span>
<span id="cb274-6"><a href="comp-algo.html#cb274-6"></a>  <span class="kw">predict</span>(arbre,<span class="dt">newdata=</span>newX,<span class="dt">type=</span><span class="st">&quot;prob&quot;</span>)[,<span class="dv">2</span>]</span>
<span id="cb274-7"><a href="comp-algo.html#cb274-7"></a>}</span>
<span id="cb274-8"><a href="comp-algo.html#cb274-8"></a>prev[<span class="dv">2</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.arbre</span>(ad.data1,newX)</span></code></pre></div></li>
<li><p><strong>Lasso et Ridge</strong> où le paramètre de régularisation est choisi par validation croisée 10 blocs en minimisant la déviance binomiale :</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="comp-algo.html#cb275-1"></a>prev.ridge &lt;-<span class="st"> </span><span class="cf">function</span>(df.X,df.Y,newX){</span>
<span id="cb275-2"><a href="comp-algo.html#cb275-2"></a>  ridge &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(df.X,df.Y,<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>,<span class="dt">alpha=</span><span class="dv">0</span>)</span>
<span id="cb275-3"><a href="comp-algo.html#cb275-3"></a>  <span class="kw">as.vector</span>(<span class="kw">predict</span>(ridge,<span class="dt">newx =</span> newX,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>))</span>
<span id="cb275-4"><a href="comp-algo.html#cb275-4"></a>}</span>
<span id="cb275-5"><a href="comp-algo.html#cb275-5"></a>prev.lasso &lt;-<span class="st"> </span><span class="cf">function</span>(df.X,df.Y,newX){</span>
<span id="cb275-6"><a href="comp-algo.html#cb275-6"></a>  lasso &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(df.X,df.Y,<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>,<span class="dt">alpha=</span><span class="dv">1</span>)</span>
<span id="cb275-7"><a href="comp-algo.html#cb275-7"></a>  <span class="kw">as.vector</span>(<span class="kw">predict</span>(lasso,<span class="dt">newx =</span> newX,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>))</span>
<span id="cb275-8"><a href="comp-algo.html#cb275-8"></a>}</span>
<span id="cb275-9"><a href="comp-algo.html#cb275-9"></a>prev[<span class="dv">3</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.ridge</span>(X.ad,Y.ad,newX.X)</span>
<span id="cb275-10"><a href="comp-algo.html#cb275-10"></a>prev[<span class="dv">4</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.lasso</span>(X.ad,Y.ad,newX.X)</span></code></pre></div></li>
<li><p><strong>Forêt aléatoire</strong> avec les paramètres par défaut :</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="comp-algo.html#cb276-1"></a>prev.foret &lt;-<span class="st"> </span><span class="cf">function</span>(df,newX){</span>
<span id="cb276-2"><a href="comp-algo.html#cb276-2"></a>  foret &lt;-<span class="st"> </span><span class="kw">ranger</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df,<span class="dt">probability=</span><span class="ot">TRUE</span>)</span>
<span id="cb276-3"><a href="comp-algo.html#cb276-3"></a>  <span class="kw">predict</span>(foret,<span class="dt">data=</span>newX,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)<span class="op">$</span>predictions[,<span class="dv">2</span>]</span>
<span id="cb276-4"><a href="comp-algo.html#cb276-4"></a>}</span>
<span id="cb276-5"><a href="comp-algo.html#cb276-5"></a>prev[<span class="dv">5</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.foret</span>(ad.data1,newX)</span></code></pre></div></li>
<li><p><strong>Adaboost et logitboost</strong> avec le nombre d’itérations choisi par validation croisée 5 blocs :</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="comp-algo.html#cb277-1"></a>prev.ada &lt;-<span class="st"> </span><span class="cf">function</span>(df,newX){</span>
<span id="cb277-2"><a href="comp-algo.html#cb277-2"></a>  ada &lt;-<span class="st"> </span><span class="kw">gbm</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df,<span class="dt">distribution=</span><span class="st">&quot;adaboost&quot;</span>,<span class="dt">interaction.depth=</span><span class="dv">2</span>,</span>
<span id="cb277-3"><a href="comp-algo.html#cb277-3"></a>         <span class="dt">bag.fraction=</span><span class="dv">1</span>,<span class="dt">cv.folds =</span> <span class="dv">5</span>,<span class="dt">n.trees=</span><span class="dv">500</span>)</span>
<span id="cb277-4"><a href="comp-algo.html#cb277-4"></a>  nb.it &lt;-<span class="st"> </span><span class="kw">gbm.perf</span>(ada,<span class="dt">plot.it=</span><span class="ot">FALSE</span>)</span>
<span id="cb277-5"><a href="comp-algo.html#cb277-5"></a>  <span class="kw">predict</span>(ada,<span class="dt">newdata=</span>newX,<span class="dt">n.trees=</span>nb.it,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb277-6"><a href="comp-algo.html#cb277-6"></a>}</span>
<span id="cb277-7"><a href="comp-algo.html#cb277-7"></a></span>
<span id="cb277-8"><a href="comp-algo.html#cb277-8"></a>prev.logit &lt;-<span class="st"> </span><span class="cf">function</span>(df,newX){</span>
<span id="cb277-9"><a href="comp-algo.html#cb277-9"></a>  logit &lt;-<span class="st"> </span><span class="kw">gbm</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df,<span class="dt">distribution=</span><span class="st">&quot;bernoulli&quot;</span>,<span class="dt">interaction.depth=</span><span class="dv">2</span>,</span>
<span id="cb277-10"><a href="comp-algo.html#cb277-10"></a>           <span class="dt">bag.fraction=</span><span class="dv">1</span>,<span class="dt">cv.folds =</span> <span class="dv">5</span>,<span class="dt">n.trees=</span><span class="dv">500</span>)</span>
<span id="cb277-11"><a href="comp-algo.html#cb277-11"></a>  nb.it &lt;-<span class="st"> </span><span class="kw">gbm.perf</span>(logit,<span class="dt">plot.it=</span><span class="ot">FALSE</span>)</span>
<span id="cb277-12"><a href="comp-algo.html#cb277-12"></a>  <span class="kw">predict</span>(logit,<span class="dt">newdata=</span>newX,<span class="dt">n.trees=</span>nb.it,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb277-13"><a href="comp-algo.html#cb277-13"></a>}    </span>
<span id="cb277-14"><a href="comp-algo.html#cb277-14"></a></span>
<span id="cb277-15"><a href="comp-algo.html#cb277-15"></a>prev[<span class="dv">6</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.ada</span>(ad.data2,newX)</span>
<span id="cb277-16"><a href="comp-algo.html#cb277-16"></a>prev[<span class="dv">7</span>,<span class="dv">2</span>] &lt;-<span class="st"> </span><span class="kw">prev.logit</span>(ad.data2,newX)</span></code></pre></div></li>
</ul>
<p>On peut visualiser la prévision de chaque algorithme</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="comp-algo.html#cb278-1"></a>prev</span>
<span id="cb278-2"><a href="comp-algo.html#cb278-2"></a><span class="co"># A tibble: 7 x 2</span></span>
<span id="cb278-3"><a href="comp-algo.html#cb278-3"></a>  algo   prev</span>
<span id="cb278-4"><a href="comp-algo.html#cb278-4"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb278-5"><a href="comp-algo.html#cb278-5"></a><span class="dv">1</span> SVM   <span class="fl">0.950</span></span>
<span id="cb278-6"><a href="comp-algo.html#cb278-6"></a><span class="dv">2</span> arbre <span class="fl">0.990</span></span>
<span id="cb278-7"><a href="comp-algo.html#cb278-7"></a><span class="dv">3</span> ridge <span class="fl">0.984</span></span>
<span id="cb278-8"><a href="comp-algo.html#cb278-8"></a><span class="dv">4</span> lasso <span class="fl">0.980</span></span>
<span id="cb278-9"><a href="comp-algo.html#cb278-9"></a><span class="dv">5</span> foret <span class="fl">0.979</span></span>
<span id="cb278-10"><a href="comp-algo.html#cb278-10"></a><span class="dv">6</span> ada   <span class="fl">0.974</span></span>
<span id="cb278-11"><a href="comp-algo.html#cb278-11"></a><span class="dv">7</span> logit <span class="fl">0.983</span></span></code></pre></div>

<div class="exercise">
<span id="exr:exo-comp-meth-VC" class="exercise"><strong>Exercice 8.1  (Choix d’un algorithme par validation croisée)  </strong></span>
</div>

<p>Choisir un algorithme parmi les précédents en utilisant comme critère l’erreur de classification ainsi que la courbe ROC et l’AUC. On pourra faire une validation croisée 10 blocs (même si ça peut être un peu long…).</p>
<div class="corR">
<p>
On commence par définir les blocs
</p>
</div>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="comp-algo.html#cb279-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb279-2"><a href="comp-algo.html#cb279-2"></a>bloc &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="kw">nrow</span>(ad.data1),<span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb279-3"><a href="comp-algo.html#cb279-3"></a><span class="kw">table</span>(bloc)</span>
<span id="cb279-4"><a href="comp-algo.html#cb279-4"></a>bloc</span>
<span id="cb279-5"><a href="comp-algo.html#cb279-5"></a>  <span class="dv">1</span>   <span class="dv">2</span>   <span class="dv">3</span>   <span class="dv">4</span>   <span class="dv">5</span>   <span class="dv">6</span>   <span class="dv">7</span>   <span class="dv">8</span>   <span class="dv">9</span>  <span class="dv">10</span> </span>
<span id="cb279-6"><a href="comp-algo.html#cb279-6"></a><span class="dv">309</span> <span class="dv">327</span> <span class="dv">329</span> <span class="dv">310</span> <span class="dv">358</span> <span class="dv">354</span> <span class="dv">304</span> <span class="dv">337</span> <span class="dv">342</span> <span class="dv">309</span> </span></code></pre></div>
<div class="corR">
<p>
On effectue la validation croisée pour obtenir un score pour chaque individu :
</p>
</div>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="comp-algo.html#cb280-1"></a><span class="kw">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb280-2"><a href="comp-algo.html#cb280-2"></a>score &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(ad.data1),<span class="dt">ncol=</span><span class="dv">7</span>))</span>
<span id="cb280-3"><a href="comp-algo.html#cb280-3"></a><span class="kw">names</span>(score) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;svm&quot;</span>,<span class="st">&quot;arbre&quot;</span>,<span class="st">&quot;ridge&quot;</span>,<span class="st">&quot;lasso&quot;</span>,<span class="st">&quot;foret&quot;</span>,<span class="st">&quot;ada&quot;</span>,<span class="st">&quot;logit&quot;</span>)</span>
<span id="cb280-4"><a href="comp-algo.html#cb280-4"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</span>
<span id="cb280-5"><a href="comp-algo.html#cb280-5"></a>  ind.test &lt;-<span class="st"> </span>bloc<span class="op">==</span>k</span>
<span id="cb280-6"><a href="comp-algo.html#cb280-6"></a>  dapp &lt;-<span class="st"> </span>ad.data1[<span class="op">!</span>ind.test,]</span>
<span id="cb280-7"><a href="comp-algo.html#cb280-7"></a>  dtest &lt;-<span class="st"> </span>ad.data1[ind.test,]</span>
<span id="cb280-8"><a href="comp-algo.html#cb280-8"></a>  dapp2 &lt;-<span class="st"> </span>ad.data2[<span class="op">!</span>ind.test,]</span>
<span id="cb280-9"><a href="comp-algo.html#cb280-9"></a>  dtest2 &lt;-<span class="st"> </span>ad.data2[ind.test,]</span>
<span id="cb280-10"><a href="comp-algo.html#cb280-10"></a>  X.app &lt;-<span class="st"> </span>X.ad[<span class="op">!</span>ind.test,]</span>
<span id="cb280-11"><a href="comp-algo.html#cb280-11"></a>  X.test &lt;-<span class="st"> </span>X.ad[ind.test,]</span>
<span id="cb280-12"><a href="comp-algo.html#cb280-12"></a>  Y.app &lt;-<span class="st"> </span>Y.ad[<span class="op">!</span>ind.test]</span>
<span id="cb280-13"><a href="comp-algo.html#cb280-13"></a>  Y.test &lt;-<span class="st"> </span>Y.ad[ind.test]</span>
<span id="cb280-14"><a href="comp-algo.html#cb280-14"></a>  svm.k &lt;-<span class="st"> </span><span class="kw">prev.svm</span>(<span class="dt">df=</span>dapp,<span class="dt">newX =</span> dtest)</span>
<span id="cb280-15"><a href="comp-algo.html#cb280-15"></a>  arbre.k &lt;-<span class="st"> </span><span class="kw">prev.arbre</span>(<span class="dt">df=</span>dapp,<span class="dt">newX =</span> dtest)</span>
<span id="cb280-16"><a href="comp-algo.html#cb280-16"></a>  ridge.k &lt;-<span class="st"> </span><span class="kw">prev.ridge</span>(<span class="dt">df.X=</span>X.app,<span class="dt">df.Y=</span>Y.app,<span class="dt">newX=</span>X.test)</span>
<span id="cb280-17"><a href="comp-algo.html#cb280-17"></a>  lasso.k &lt;-<span class="st"> </span><span class="kw">prev.lasso</span>(<span class="dt">df.X=</span>X.app,<span class="dt">df.Y=</span>Y.app,<span class="dt">newX=</span>X.test)</span>
<span id="cb280-18"><a href="comp-algo.html#cb280-18"></a>  foret.k &lt;-<span class="st"> </span><span class="kw">prev.foret</span>(<span class="dt">df=</span>dapp,<span class="dt">newX =</span> dtest)</span>
<span id="cb280-19"><a href="comp-algo.html#cb280-19"></a>  ada.k &lt;-<span class="st"> </span><span class="kw">prev.ada</span>(<span class="dt">df=</span>dapp2,<span class="dt">newX=</span>dtest2)</span>
<span id="cb280-20"><a href="comp-algo.html#cb280-20"></a>  logit.k &lt;-<span class="st"> </span><span class="kw">prev.logit</span>(<span class="dt">df=</span>dapp2,<span class="dt">newX=</span>dtest2)</span>
<span id="cb280-21"><a href="comp-algo.html#cb280-21"></a>  score[ind.test,] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">arbre=</span>svm.k,<span class="dt">arbre=</span>arbre.k,<span class="dt">ridge=</span>ridge.k,</span>
<span id="cb280-22"><a href="comp-algo.html#cb280-22"></a>                                 <span class="dt">lasso=</span>lasso.k,<span class="dt">foret=</span>foret.k,<span class="dt">ada=</span>ada.k,<span class="dt">logit=</span>logit.k)</span>
<span id="cb280-23"><a href="comp-algo.html#cb280-23"></a>}</span></code></pre></div>
<div class="corR">
<p>
On ajoute à cette matrice score les valeurs observées que l’on recode en 0-1 :
</p>
</div>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="comp-algo.html#cb281-1"></a>score1 &lt;-<span class="st"> </span>score <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb281-2"><a href="comp-algo.html#cb281-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">obs=</span><span class="kw">fct_recode</span>(ad.data1<span class="op">$</span>Y,<span class="st">&quot;0&quot;</span>=<span class="st">&quot;ad.&quot;</span>,<span class="st">&quot;1&quot;</span>=<span class="st">&quot;nonad.&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb281-3"><a href="comp-algo.html#cb281-3"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">-</span>obs,<span class="dt">names_to=</span><span class="st">&quot;Methode&quot;</span>,<span class="dt">values_to=</span><span class="st">&quot;score&quot;</span>)</span></code></pre></div>
<div class="corR">
<p>
On peut maintenant déduire tous les critères en confondant les valeurs prédites aux valeurs observées.
</p>
</div>
<div class="corR">
<ul>
<li>
<strong>Courbe ROC</strong>
</li>
</ul>
</div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="comp-algo.html#cb282-1"></a><span class="kw">library</span>(plotROC)</span>
<span id="cb282-2"><a href="comp-algo.html#cb282-2"></a>rocplot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(score1)<span class="op">+</span><span class="kw">aes</span>(<span class="dt">m=</span>score,<span class="dt">d=</span><span class="kw">as.numeric</span>(obs),<span class="dt">color=</span>Methode)<span class="op">+</span><span class="kw">geom_roc</span>()<span class="op">+</span><span class="kw">theme_classic</span>()</span>
<span id="cb282-3"><a href="comp-algo.html#cb282-3"></a>rocplot</span></code></pre></div>
<p><img src="TUTO_ML_files/figure-html/unnamed-chunk-440-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="corR">
<ul>
<li>
<strong>AUC</strong>
</li>
</ul>
</div>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="comp-algo.html#cb283-1"></a>score1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Methode) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">AUC=</span><span class="kw">as.numeric</span>(pROC<span class="op">::</span><span class="kw">auc</span>(obs,score))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb283-2"><a href="comp-algo.html#cb283-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">AUC=</span><span class="kw">round</span>(AUC,<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(AUC))</span>
<span id="cb283-3"><a href="comp-algo.html#cb283-3"></a><span class="co"># A tibble: 7 x 2</span></span>
<span id="cb283-4"><a href="comp-algo.html#cb283-4"></a>  Methode   AUC</span>
<span id="cb283-5"><a href="comp-algo.html#cb283-5"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb283-6"><a href="comp-algo.html#cb283-6"></a><span class="dv">1</span> ridge   <span class="fl">0.98</span> </span>
<span id="cb283-7"><a href="comp-algo.html#cb283-7"></a><span class="dv">2</span> foret   <span class="fl">0.976</span></span>
<span id="cb283-8"><a href="comp-algo.html#cb283-8"></a><span class="dv">3</span> lasso   <span class="fl">0.951</span></span>
<span id="cb283-9"><a href="comp-algo.html#cb283-9"></a><span class="dv">4</span> logit   <span class="fl">0.945</span></span>
<span id="cb283-10"><a href="comp-algo.html#cb283-10"></a><span class="dv">5</span> ada     <span class="fl">0.94</span> </span>
<span id="cb283-11"><a href="comp-algo.html#cb283-11"></a><span class="dv">6</span> arbre   <span class="fl">0.897</span></span>
<span id="cb283-12"><a href="comp-algo.html#cb283-12"></a><span class="dv">7</span> svm     <span class="fl">0.813</span></span></code></pre></div>
<div class="corR">
<ul>
<li>
<strong>Erreur de classification</strong>
</li>
</ul>
</div>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="comp-algo.html#cb284-1"></a>score1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">prev=</span><span class="kw">round</span>(score),<span class="dt">err=</span>prev<span class="op">!=</span>obs) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb284-2"><a href="comp-algo.html#cb284-2"></a><span class="st">  </span><span class="kw">group_by</span>(Methode) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">Err_classif=</span><span class="kw">mean</span>(err)) <span class="op">%&gt;%</span></span>
<span id="cb284-3"><a href="comp-algo.html#cb284-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Err_classif=</span><span class="kw">round</span>(Err_classif,<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Err_classif)</span>
<span id="cb284-4"><a href="comp-algo.html#cb284-4"></a><span class="co"># A tibble: 7 x 2</span></span>
<span id="cb284-5"><a href="comp-algo.html#cb284-5"></a>  Methode Err_classif</span>
<span id="cb284-6"><a href="comp-algo.html#cb284-6"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">         </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb284-7"><a href="comp-algo.html#cb284-7"></a><span class="dv">1</span> foret         <span class="fl">0.029</span></span>
<span id="cb284-8"><a href="comp-algo.html#cb284-8"></a><span class="dv">2</span> arbre         <span class="fl">0.03</span> </span>
<span id="cb284-9"><a href="comp-algo.html#cb284-9"></a><span class="dv">3</span> logit         <span class="fl">0.03</span> </span>
<span id="cb284-10"><a href="comp-algo.html#cb284-10"></a><span class="dv">4</span> ridge         <span class="fl">0.03</span> </span>
<span id="cb284-11"><a href="comp-algo.html#cb284-11"></a><span class="dv">5</span> lasso         <span class="fl">0.031</span></span>
<span id="cb284-12"><a href="comp-algo.html#cb284-12"></a><span class="dv">6</span> ada           <span class="fl">0.038</span></span>
<span id="cb284-13"><a href="comp-algo.html#cb284-13"></a><span class="dv">7</span> svm           <span class="fl">0.101</span></span></code></pre></div>
<div class="corR">
<p>
On remarque que la svm possède les plus mauvais résultats. Cela ne signifie pas forcément que la méthode est mauvaise, peut-être que les choix qui ont été faits (noyaux gaussien, et grilles de paramètres) ne sont pas pertinents. Les arbres se révèlent également peu efficaces pour la courbe ROC et l’AUC, il est rare que les arbres soient parmi les meilleurs algorithmes contrairement au gradient boosting et aux forêts aléatoires. En terme d’AUC, la régression ridge et les forêts aléatoires se distinguent avec de très bonnes performances. On choisira l’algorithme final parmi ces deux là.
</p>
</div>

<div class="exercise">
<span id="exr:exo-comp-reeq-VC" class="exercise"><strong>Exercice 8.2  (Choix d’un algorithme de ré-équilibrage par validation croisée)  </strong></span>
</div>

<p>On considère le même jeu de données que précédemment. Choisir un algorithme de ré-équilibrage par validation croisée. Il s’agira de combiner des méthodes de ré-équilibrage (random over/under sampling, smote, tomek…) avec des algorithmes de prévision de machine learning. On pourra se restreindre au modèle logistique avec calcul des estimateurs par maximum de vraisemblance, ridge, lasso…</p>
<div class="corR">
<p>
On recode les modalités de <span class="math inline"><span class="math inline">\(Y\)</span></span> en 0-1 :
</p>
</div>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="comp-algo.html#cb285-1"></a>ad.data1 &lt;-<span class="st"> </span>ad.data1 <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb285-2"><a href="comp-algo.html#cb285-2"></a><span class="st">  </span><span class="kw">transform</span>(<span class="dt">Y=</span><span class="kw">fct_recode</span>(Y,<span class="st">&quot;0&quot;</span>=<span class="st">&quot;nonad.&quot;</span>,<span class="st">&quot;1&quot;</span>=<span class="st">&quot;ad.&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb285-3"><a href="comp-algo.html#cb285-3"></a><span class="st">  </span><span class="kw">transform</span>(<span class="dt">Y=</span><span class="kw">fct_inseq</span>(Y))</span></code></pre></div>
<div class="corR">
<p>
On définit d’abord les 10 blocs pour la validation croisée.
</p>
</div>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="comp-algo.html#cb286-1"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb286-2"><a href="comp-algo.html#cb286-2"></a>bloc &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,<span class="kw">nrow</span>(ad.data1),<span class="dt">replace=</span><span class="ot">TRUE</span>)</span>
<span id="cb286-3"><a href="comp-algo.html#cb286-3"></a><span class="kw">table</span>(bloc)</span></code></pre></div>
<div class="corR">
<p>
Puis on définit une liste <code>SCORE</code> de longueur 5 dont chaque élément contiendra un dataframe avec les probabilités que l’image soit une publicité estimées par chaque méthode pour chaque algorithme de ré-équilibrage.
</p>
</div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="comp-algo.html#cb287-1"></a>score &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(ad.data1),<span class="dt">ncol=</span><span class="dv">3</span>))</span>
<span id="cb287-2"><a href="comp-algo.html#cb287-2"></a><span class="kw">names</span>(score) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>,<span class="st">&quot;lasso&quot;</span>,<span class="st">&quot;ridge&quot;</span>)</span>
<span id="cb287-3"><a href="comp-algo.html#cb287-3"></a>SCORE &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">brute=</span>score,<span class="dt">over=</span>score,<span class="dt">smote=</span>score,<span class="dt">under=</span>score,<span class="dt">tomek=</span>score)</span></code></pre></div>
<div class="corR">
<p>
On peut maintenant faire la validation croisée, pour chaque valeur de <code>k</code> entre 1 et 10 :
</p>
</div>
<div class="corR">
<ul>
<li>
on calcule les échantillons d’apprentissage et de test
</li>
</ul>
</div>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="comp-algo.html#cb288-1"></a>ind.test &lt;-<span class="st"> </span>bloc<span class="op">==</span>k</span>
<span id="cb288-2"><a href="comp-algo.html#cb288-2"></a>dapp &lt;-<span class="st"> </span>ad.data1[<span class="op">!</span>ind.test,]</span>
<span id="cb288-3"><a href="comp-algo.html#cb288-3"></a>dtest &lt;-<span class="st"> </span>ad.data1[ind.test,]</span>
<span id="cb288-4"><a href="comp-algo.html#cb288-4"></a>X.test &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>dtest)[,<span class="op">-</span><span class="dv">1</span>]</span></code></pre></div>
<div class="corR">
<ul>
<li>
on ré-équilibre les données d’apprentissage uniquement
</li>
</ul>
</div>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="comp-algo.html#cb289-1"></a>ech.app &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">norm=</span>dapp,</span>
<span id="cb289-2"><a href="comp-algo.html#cb289-2"></a>                <span class="dt">over=</span><span class="kw">RandOverClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb289-3"><a href="comp-algo.html#cb289-3"></a>                <span class="dt">smote=</span><span class="kw">SmoteClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb289-4"><a href="comp-algo.html#cb289-4"></a>                <span class="dt">under=</span><span class="kw">RandUnderClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb289-5"><a href="comp-algo.html#cb289-5"></a>                <span class="dt">tomek=</span><span class="kw">TomekClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp)[[<span class="dv">1</span>]])</span>
<span id="cb289-6"><a href="comp-algo.html#cb289-6"></a>mod.mat.list &lt;-<span class="st"> </span><span class="cf">function</span>(df){<span class="kw">model.matrix</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df)[,<span class="op">-</span><span class="dv">1</span>]}</span>
<span id="cb289-7"><a href="comp-algo.html#cb289-7"></a>Y.list &lt;-<span class="st"> </span><span class="cf">function</span>(df) df<span class="op">$</span>Y </span>
<span id="cb289-8"><a href="comp-algo.html#cb289-8"></a>  </span>
<span id="cb289-9"><a href="comp-algo.html#cb289-9"></a>X.app &lt;-<span class="st"> </span><span class="kw">lapply</span>(ech.app,mod.mat.list)</span>
<span id="cb289-10"><a href="comp-algo.html#cb289-10"></a>Y.app &lt;-<span class="st"> </span><span class="kw">lapply</span>(ech.app,Y.list)</span></code></pre></div>
<div class="corR">
<ul>
<li>
on entraine les algorithmes logistique (MV), lasso et ridge sur tous les échantillons d’apprentissage. Le paramètre de régularisation des méthode lasso et ridge est sélectionné en faisant une validation croisée 10 blocs, c’est-à-dire que l’échantillon d’apprentissage est coupé en 10 blocs pour choisir ce paramètre
</li>
</ul>
</div>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="comp-algo.html#cb290-1"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb290-2"><a href="comp-algo.html#cb290-2"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</span>
<span id="cb290-3"><a href="comp-algo.html#cb290-3"></a>  lasso &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(X.app[[j]],Y.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb290-4"><a href="comp-algo.html#cb290-4"></a>  ridge &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(X.app[[j]],Y.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>,<span class="dt">alpha=</span><span class="dv">0</span>)</span>
<span id="cb290-5"><a href="comp-algo.html#cb290-5"></a>  logit &lt;-<span class="st"> </span><span class="kw">glm</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>ech.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span></code></pre></div>
<div class="corR">
<ul>
<li>
on calcule enfin les probabilités estimées que l’image soit une publicité pour chaque individu de l’échantillon test
</li>
</ul>
</div>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="comp-algo.html#cb291-1"></a>  SCORE[[j]][ind.test,] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb291-2"><a href="comp-algo.html#cb291-2"></a>    <span class="dt">logit=</span><span class="kw">predict.glm</span>(logit,<span class="dt">newdata=</span>dtest,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>),</span>
<span id="cb291-3"><a href="comp-algo.html#cb291-3"></a>    <span class="dt">lasso=</span><span class="kw">as.vector</span>(<span class="kw">predict</span>(lasso,<span class="dt">newx=</span>X.test,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)),</span>
<span id="cb291-4"><a href="comp-algo.html#cb291-4"></a>    <span class="dt">ridge=</span><span class="kw">as.vector</span>(<span class="kw">predict</span>(ridge,<span class="dt">newx=</span>X.test,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>))</span>
<span id="cb291-5"><a href="comp-algo.html#cb291-5"></a>  )</span>
<span id="cb291-6"><a href="comp-algo.html#cb291-6"></a><span class="er">}</span></span></code></pre></div>
<div class="corR">
<p>
Le code entier se trouve ci-dessous :
</p>
</div>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="comp-algo.html#cb292-1"></a><span class="kw">set.seed</span>(<span class="dv">4321</span>)</span>
<span id="cb292-2"><a href="comp-algo.html#cb292-2"></a><span class="kw">library</span>(glmnet)</span>
<span id="cb292-3"><a href="comp-algo.html#cb292-3"></a>score &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">matrix</span>(<span class="dv">0</span>,<span class="dt">nrow=</span><span class="kw">nrow</span>(ad.data1),<span class="dt">ncol=</span><span class="dv">3</span>))</span>
<span id="cb292-4"><a href="comp-algo.html#cb292-4"></a><span class="kw">names</span>(score) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;logit&quot;</span>,<span class="st">&quot;lasso&quot;</span>,<span class="st">&quot;ridge&quot;</span>)</span>
<span id="cb292-5"><a href="comp-algo.html#cb292-5"></a>SCORE &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">brute=</span>score,<span class="dt">over=</span>score,<span class="dt">smote=</span>score,<span class="dt">under=</span>score,<span class="dt">tomek=</span>score)</span>
<span id="cb292-6"><a href="comp-algo.html#cb292-6"></a></span>
<span id="cb292-7"><a href="comp-algo.html#cb292-7"></a><span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</span>
<span id="cb292-8"><a href="comp-algo.html#cb292-8"></a>  <span class="kw">print</span>(k)</span>
<span id="cb292-9"><a href="comp-algo.html#cb292-9"></a>  ind.test &lt;-<span class="st"> </span>bloc<span class="op">==</span>k</span>
<span id="cb292-10"><a href="comp-algo.html#cb292-10"></a>  dapp &lt;-<span class="st"> </span>ad.data1[<span class="op">!</span>ind.test,]</span>
<span id="cb292-11"><a href="comp-algo.html#cb292-11"></a>  dtest &lt;-<span class="st"> </span>ad.data1[ind.test,]</span>
<span id="cb292-12"><a href="comp-algo.html#cb292-12"></a>  X.test &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>dtest)[,<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb292-13"><a href="comp-algo.html#cb292-13"></a>  </span>
<span id="cb292-14"><a href="comp-algo.html#cb292-14"></a>  ech.app &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">norm=</span>dapp,</span>
<span id="cb292-15"><a href="comp-algo.html#cb292-15"></a>                  <span class="dt">over=</span><span class="kw">RandOverClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb292-16"><a href="comp-algo.html#cb292-16"></a>                  <span class="dt">smote=</span><span class="kw">SmoteClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb292-17"><a href="comp-algo.html#cb292-17"></a>                  <span class="dt">under=</span><span class="kw">RandUnderClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp),</span>
<span id="cb292-18"><a href="comp-algo.html#cb292-18"></a>                  <span class="dt">tomek=</span><span class="kw">TomekClassif</span>(Y<span class="op">~</span>.,<span class="dt">dat=</span>dapp)[[<span class="dv">1</span>]])</span>
<span id="cb292-19"><a href="comp-algo.html#cb292-19"></a></span>
<span id="cb292-20"><a href="comp-algo.html#cb292-20"></a>  mod.mat.list &lt;-<span class="st"> </span><span class="cf">function</span>(df){<span class="kw">model.matrix</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>df)[,<span class="op">-</span><span class="dv">1</span>]}</span>
<span id="cb292-21"><a href="comp-algo.html#cb292-21"></a>  Y.list &lt;-<span class="st"> </span><span class="cf">function</span>(df) df<span class="op">$</span>Y </span>
<span id="cb292-22"><a href="comp-algo.html#cb292-22"></a>  </span>
<span id="cb292-23"><a href="comp-algo.html#cb292-23"></a>  X.app &lt;-<span class="st"> </span><span class="kw">lapply</span>(ech.app,mod.mat.list)</span>
<span id="cb292-24"><a href="comp-algo.html#cb292-24"></a>  Y.app &lt;-<span class="st"> </span><span class="kw">lapply</span>(ech.app,Y.list)</span>
<span id="cb292-25"><a href="comp-algo.html#cb292-25"></a>  </span>
<span id="cb292-26"><a href="comp-algo.html#cb292-26"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>){</span>
<span id="cb292-27"><a href="comp-algo.html#cb292-27"></a>    <span class="kw">print</span>(j)</span>
<span id="cb292-28"><a href="comp-algo.html#cb292-28"></a>    lasso &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(X.app[[j]],Y.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb292-29"><a href="comp-algo.html#cb292-29"></a>    ridge &lt;-<span class="st"> </span><span class="kw">cv.glmnet</span>(X.app[[j]],Y.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>,<span class="dt">alpha=</span><span class="dv">0</span>)</span>
<span id="cb292-30"><a href="comp-algo.html#cb292-30"></a>    logit &lt;-<span class="st"> </span><span class="kw">glm</span>(Y<span class="op">~</span>.,<span class="dt">data=</span>ech.app[[j]],<span class="dt">family=</span><span class="st">&quot;binomial&quot;</span>)</span>
<span id="cb292-31"><a href="comp-algo.html#cb292-31"></a>    SCORE[[j]][ind.test,] &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb292-32"><a href="comp-algo.html#cb292-32"></a>      <span class="dt">logit=</span><span class="kw">predict.glm</span>(logit,<span class="dt">newdata=</span>dtest,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>),</span>
<span id="cb292-33"><a href="comp-algo.html#cb292-33"></a>      <span class="dt">lasso=</span><span class="kw">as.vector</span>(<span class="kw">predict</span>(lasso,<span class="dt">newx=</span>X.test,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>)),</span>
<span id="cb292-34"><a href="comp-algo.html#cb292-34"></a>      <span class="dt">ridge=</span><span class="kw">as.vector</span>(<span class="kw">predict</span>(ridge,<span class="dt">newx=</span>X.test,<span class="dt">type=</span><span class="st">&quot;response&quot;</span>))</span>
<span id="cb292-35"><a href="comp-algo.html#cb292-35"></a>    )</span>
<span id="cb292-36"><a href="comp-algo.html#cb292-36"></a>  }</span>
<span id="cb292-37"><a href="comp-algo.html#cb292-37"></a>}</span></code></pre></div>
<div class="corR">
<p>
On assemble tous les résultats dans un seul dataframe de 4 colonnes qui contiendra une colonne :
</p>
<ul>
<li>
<code>meth</code> pour le nom de l’algorithme de ré-équilibrage ;
</li>
<li>
<code>obs</code> pour les valeurs observées de <span class="math inline"><span class="math inline">\(Y\)</span></span> pour chaque individu (0 ou 1) ;
</li>
<li>
<code>algo</code> pour l’algorithme de prévision (logistique, lasso, ridge) ;
</li>
<li>
<code>score</code> pour la probabilité que l’image soit une publicité estimée par l’algorithme.
</li>
</ul>
</div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="comp-algo.html#cb293-1"></a>mat.score &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(<span class="dt">brutes=</span>SCORE[[<span class="dv">1</span>]],</span>
<span id="cb293-2"><a href="comp-algo.html#cb293-2"></a>                       <span class="dt">over=</span>SCORE[[<span class="dv">2</span>]],</span>
<span id="cb293-3"><a href="comp-algo.html#cb293-3"></a>                       <span class="dt">smote=</span>SCORE[[<span class="dv">3</span>]],</span>
<span id="cb293-4"><a href="comp-algo.html#cb293-4"></a>                       <span class="dt">under=</span>SCORE[[<span class="dv">4</span>]],</span>
<span id="cb293-5"><a href="comp-algo.html#cb293-5"></a>                       <span class="dt">tomek=</span>SCORE[[<span class="dv">5</span>]],<span class="dt">.id=</span><span class="st">&quot;meth&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb293-6"><a href="comp-algo.html#cb293-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">obs=</span><span class="kw">rep</span>(ad.data1<span class="op">$</span>Y,<span class="dv">5</span>))  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb293-7"><a href="comp-algo.html#cb293-7"></a><span class="st">  </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;algo&quot;</span>,<span class="dt">value=</span><span class="st">&quot;score&quot;</span>,logit,lasso,ridge)</span></code></pre></div>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="comp-algo.html#cb294-1"></a><span class="kw">head</span>(mat.score)</span>
<span id="cb294-2"><a href="comp-algo.html#cb294-2"></a>    meth obs  algo        score</span>
<span id="cb294-3"><a href="comp-algo.html#cb294-3"></a><span class="dv">1</span> brutes   <span class="dv">1</span> logit <span class="fl">1.000000e+00</span></span>
<span id="cb294-4"><a href="comp-algo.html#cb294-4"></a><span class="dv">2</span> brutes   <span class="dv">1</span> logit <span class="fl">1.000000e+00</span></span>
<span id="cb294-5"><a href="comp-algo.html#cb294-5"></a><span class="dv">3</span> brutes   <span class="dv">1</span> logit <span class="fl">1.000000e+00</span></span>
<span id="cb294-6"><a href="comp-algo.html#cb294-6"></a><span class="dv">4</span> brutes   <span class="dv">1</span> logit <span class="fl">2.220446e-16</span></span>
<span id="cb294-7"><a href="comp-algo.html#cb294-7"></a><span class="dv">5</span> brutes   <span class="dv">1</span> logit <span class="fl">1.000000e+00</span></span>
<span id="cb294-8"><a href="comp-algo.html#cb294-8"></a><span class="dv">6</span> brutes   <span class="dv">1</span> logit <span class="fl">1.000000e+00</span></span></code></pre></div>
<div class="corR">
<p>
On pourra déduire de cette matrice différents critères de performance. Nous commençons par l’AUC qui peut se calculer directement à partir des valeurs de score
</p>
</div>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="comp-algo.html#cb295-1"></a>res_auc &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(meth,algo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb295-2"><a href="comp-algo.html#cb295-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">AUC=</span><span class="kw">round</span>(pROC<span class="op">::</span><span class="kw">auc</span>(obs,score),<span class="dv">3</span>)) <span class="op">%&gt;%</span></span>
<span id="cb295-3"><a href="comp-algo.html#cb295-3"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>algo,<span class="dt">value=</span>AUC)</span>
<span id="cb295-4"><a href="comp-algo.html#cb295-4"></a>res_auc</span>
<span id="cb295-5"><a href="comp-algo.html#cb295-5"></a><span class="co"># A tibble: 5 x 4</span></span>
<span id="cb295-6"><a href="comp-algo.html#cb295-6"></a><span class="co"># Groups:   meth [5]</span></span>
<span id="cb295-7"><a href="comp-algo.html#cb295-7"></a>  meth   lasso logit ridge</span>
<span id="cb295-8"><a href="comp-algo.html#cb295-8"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb295-9"><a href="comp-algo.html#cb295-9"></a><span class="dv">1</span> brutes <span class="fl">0.943</span> <span class="fl">0.831</span> <span class="fl">0.98</span> </span>
<span id="cb295-10"><a href="comp-algo.html#cb295-10"></a><span class="dv">2</span> over   <span class="fl">0.973</span> <span class="fl">0.79</span>  <span class="fl">0.977</span></span>
<span id="cb295-11"><a href="comp-algo.html#cb295-11"></a><span class="dv">3</span> smote  <span class="fl">0.973</span> <span class="fl">0.68</span>  <span class="fl">0.977</span></span>
<span id="cb295-12"><a href="comp-algo.html#cb295-12"></a><span class="dv">4</span> tomek  <span class="fl">0.95</span>  <span class="fl">0.763</span> <span class="fl">0.979</span></span>
<span id="cb295-13"><a href="comp-algo.html#cb295-13"></a><span class="dv">5</span> under  <span class="fl">0.956</span> <span class="fl">0.787</span> <span class="fl">0.964</span></span></code></pre></div>
<div class="corR">
<p>
La plupart des autres critères (accuracy, kappa de Cohen…) nécessitent d’avoir les groupes prédits par l’algorithme. Ces prévisions s’obtiennent en fixant un seuil <span class="math inline"><span class="math inline">\(s\)</span></span> entre 0 et 1 et en prédisant groupe 1 si la probabilité est plus grande que <span class="math inline"><span class="math inline">\(s\)</span></span>, 0 sinon. On peut utiliser des méthodes de choix automatique de seuil mais, par souci de concision, nous présentons les résultats pour le seuil de 0.5. On crée donc une nouvelle colonne <code>prev</code> qui contiendra les groupes prédits :
</p>
</div>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="comp-algo.html#cb296-1"></a>mat.score &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">prev=</span><span class="kw">as.factor</span>(<span class="kw">round</span>(score)))</span></code></pre></div>
<div class="corR">
<p>
On peut maintenant en déduire :
</p>
<ul>
<li>
l’accuracy
</li>
</ul>
</div>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="comp-algo.html#cb297-1"></a>res_acc &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">ok=</span>(prev<span class="op">==</span>obs)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb297-2"><a href="comp-algo.html#cb297-2"></a><span class="st">  </span><span class="kw">group_by</span>(meth,algo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb297-3"><a href="comp-algo.html#cb297-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">Acc=</span><span class="kw">round</span>(<span class="kw">mean</span>(ok),<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb297-4"><a href="comp-algo.html#cb297-4"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>algo,<span class="dt">value=</span>Acc)</span>
<span id="cb297-5"><a href="comp-algo.html#cb297-5"></a>res_acc</span>
<span id="cb297-6"><a href="comp-algo.html#cb297-6"></a><span class="co"># A tibble: 5 x 4</span></span>
<span id="cb297-7"><a href="comp-algo.html#cb297-7"></a><span class="co"># Groups:   meth [5]</span></span>
<span id="cb297-8"><a href="comp-algo.html#cb297-8"></a>  meth   lasso logit ridge</span>
<span id="cb297-9"><a href="comp-algo.html#cb297-9"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb297-10"><a href="comp-algo.html#cb297-10"></a><span class="dv">1</span> brutes <span class="fl">0.969</span> <span class="fl">0.886</span> <span class="fl">0.97</span> </span>
<span id="cb297-11"><a href="comp-algo.html#cb297-11"></a><span class="dv">2</span> over   <span class="fl">0.961</span> <span class="fl">0.847</span> <span class="fl">0.963</span></span>
<span id="cb297-12"><a href="comp-algo.html#cb297-12"></a><span class="dv">3</span> smote  <span class="fl">0.96</span>  <span class="fl">0.699</span> <span class="fl">0.96</span> </span>
<span id="cb297-13"><a href="comp-algo.html#cb297-13"></a><span class="dv">4</span> tomek  <span class="fl">0.969</span> <span class="fl">0.818</span> <span class="fl">0.97</span> </span>
<span id="cb297-14"><a href="comp-algo.html#cb297-14"></a><span class="dv">5</span> under  <span class="fl">0.954</span> <span class="fl">0.808</span> <span class="fl">0.955</span></span></code></pre></div>
<div class="corR">
<ul>
<li>
le balanced accuracy
</li>
</ul>
</div>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="comp-algo.html#cb298-1"></a>monba &lt;-<span class="st"> </span><span class="cf">function</span>(prev,obs){<span class="kw">confusionMatrix</span>(prev,obs,<span class="dt">positive=</span><span class="st">&quot;1&quot;</span>)<span class="op">$</span>byClass[<span class="dv">11</span>]}</span>
<span id="cb298-2"><a href="comp-algo.html#cb298-2"></a>res_ba &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(meth,algo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb298-3"><a href="comp-algo.html#cb298-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ba=</span><span class="kw">round</span>(<span class="kw">monba</span>(prev,obs),<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb298-4"><a href="comp-algo.html#cb298-4"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>algo,<span class="dt">value=</span>ba)</span>
<span id="cb298-5"><a href="comp-algo.html#cb298-5"></a>res_ba</span>
<span id="cb298-6"><a href="comp-algo.html#cb298-6"></a><span class="co"># A tibble: 5 x 4</span></span>
<span id="cb298-7"><a href="comp-algo.html#cb298-7"></a><span class="co"># Groups:   meth [5]</span></span>
<span id="cb298-8"><a href="comp-algo.html#cb298-8"></a>  meth   lasso logit ridge</span>
<span id="cb298-9"><a href="comp-algo.html#cb298-9"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb298-10"><a href="comp-algo.html#cb298-10"></a><span class="dv">1</span> brutes <span class="fl">0.898</span> <span class="fl">0.832</span> <span class="fl">0.9</span>  </span>
<span id="cb298-11"><a href="comp-algo.html#cb298-11"></a><span class="dv">2</span> over   <span class="fl">0.931</span> <span class="fl">0.806</span> <span class="fl">0.935</span></span>
<span id="cb298-12"><a href="comp-algo.html#cb298-12"></a><span class="dv">3</span> smote  <span class="fl">0.933</span> <span class="fl">0.68</span>  <span class="fl">0.933</span></span>
<span id="cb298-13"><a href="comp-algo.html#cb298-13"></a><span class="dv">4</span> tomek  <span class="fl">0.896</span> <span class="fl">0.797</span> <span class="fl">0.9</span>  </span>
<span id="cb298-14"><a href="comp-algo.html#cb298-14"></a><span class="dv">5</span> under  <span class="fl">0.921</span> <span class="fl">0.792</span> <span class="fl">0.899</span></span></code></pre></div>
<div class="corR">
<ul>
<li>
le <span class="math inline"><span class="math inline">\(F_1\)</span></span> score
</li>
</ul>
</div>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="comp-algo.html#cb299-1"></a>monF1 &lt;-<span class="st"> </span><span class="cf">function</span>(prev,obs){<span class="kw">confusionMatrix</span>(prev,obs,<span class="dt">positive=</span><span class="st">&quot;1&quot;</span>)<span class="op">$</span>byClass[<span class="dv">7</span>]}</span>
<span id="cb299-2"><a href="comp-algo.html#cb299-2"></a>res_F1 &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(meth,algo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-3"><a href="comp-algo.html#cb299-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">F1=</span><span class="kw">round</span>(<span class="kw">monF1</span>(prev,obs),<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb299-4"><a href="comp-algo.html#cb299-4"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>algo,<span class="dt">value=</span>F1)</span>
<span id="cb299-5"><a href="comp-algo.html#cb299-5"></a>res_F1</span>
<span id="cb299-6"><a href="comp-algo.html#cb299-6"></a><span class="co"># A tibble: 5 x 4</span></span>
<span id="cb299-7"><a href="comp-algo.html#cb299-7"></a><span class="co"># Groups:   meth [5]</span></span>
<span id="cb299-8"><a href="comp-algo.html#cb299-8"></a>  meth   lasso logit ridge</span>
<span id="cb299-9"><a href="comp-algo.html#cb299-9"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb299-10"><a href="comp-algo.html#cb299-10"></a><span class="dv">1</span> brutes <span class="fl">0.879</span> <span class="fl">0.65</span>  <span class="fl">0.884</span></span>
<span id="cb299-11"><a href="comp-algo.html#cb299-11"></a><span class="dv">2</span> over   <span class="fl">0.864</span> <span class="fl">0.579</span> <span class="fl">0.873</span></span>
<span id="cb299-12"><a href="comp-algo.html#cb299-12"></a><span class="dv">3</span> smote  <span class="fl">0.863</span> <span class="fl">0.378</span> <span class="fl">0.862</span></span>
<span id="cb299-13"><a href="comp-algo.html#cb299-13"></a><span class="dv">4</span> tomek  <span class="fl">0.876</span> <span class="fl">0.542</span> <span class="fl">0.882</span></span>
<span id="cb299-14"><a href="comp-algo.html#cb299-14"></a><span class="dv">5</span> under  <span class="fl">0.843</span> <span class="fl">0.529</span> <span class="fl">0.837</span></span></code></pre></div>
<div class="corR">
<ul>
<li>
le <span class="math inline"><span class="math inline">\(\kappa\)</span></span> de Cohen
</li>
</ul>
</div>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="comp-algo.html#cb300-1"></a>monkappa &lt;-<span class="st"> </span><span class="cf">function</span>(prev,obs){<span class="kw">confusionMatrix</span>(prev,obs,<span class="dt">positive=</span><span class="st">&quot;1&quot;</span>)<span class="op">$</span>overall[<span class="dv">2</span>]}</span>
<span id="cb300-2"><a href="comp-algo.html#cb300-2"></a>res_kappa &lt;-<span class="st"> </span>mat.score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(meth,algo) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb300-3"><a href="comp-algo.html#cb300-3"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">kappa=</span><span class="kw">round</span>(<span class="kw">monkappa</span>(prev,obs),<span class="dv">3</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb300-4"><a href="comp-algo.html#cb300-4"></a><span class="st">  </span><span class="kw">spread</span>(<span class="dt">key=</span>algo,<span class="dt">value=</span>kappa)</span>
<span id="cb300-5"><a href="comp-algo.html#cb300-5"></a>res_kappa</span>
<span id="cb300-6"><a href="comp-algo.html#cb300-6"></a><span class="co"># A tibble: 5 x 4</span></span>
<span id="cb300-7"><a href="comp-algo.html#cb300-7"></a><span class="co"># Groups:   meth [5]</span></span>
<span id="cb300-8"><a href="comp-algo.html#cb300-8"></a>  meth   lasso logit ridge</span>
<span id="cb300-9"><a href="comp-algo.html#cb300-9"></a>  <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb300-10"><a href="comp-algo.html#cb300-10"></a><span class="dv">1</span> brutes <span class="fl">0.862</span> <span class="fl">0.584</span> <span class="fl">0.867</span></span>
<span id="cb300-11"><a href="comp-algo.html#cb300-11"></a><span class="dv">2</span> over   <span class="fl">0.842</span> <span class="fl">0.491</span> <span class="fl">0.851</span></span>
<span id="cb300-12"><a href="comp-algo.html#cb300-12"></a><span class="dv">3</span> smote  <span class="fl">0.839</span> <span class="fl">0.224</span> <span class="fl">0.838</span></span>
<span id="cb300-13"><a href="comp-algo.html#cb300-13"></a><span class="dv">4</span> tomek  <span class="fl">0.859</span> <span class="fl">0.44</span>  <span class="fl">0.866</span></span>
<span id="cb300-14"><a href="comp-algo.html#cb300-14"></a><span class="dv">5</span> under  <span class="fl">0.816</span> <span class="fl">0.422</span> <span class="fl">0.811</span></span></code></pre></div>
<div class="corR">
<p>
Il n’est pas facile de synthétiser tous ces résultats. Plusieurs tendances semblent néanmoins se dégager :
</p>
<ul>
<li>
le <strong>modèle logistique</strong> est clairement <strong>moins performant</strong> que les algorithmes ridge et lasso. Cela s’explique par le nombre important de variables dans le modèle. Les méthodes régularisées sont plus pertinentes dans ce contexte.
</li>
<li>
les performances des régressions ridge et lasso sont proches, avec une <strong>préférence pour le ridge</strong>.
</li>
<li>
l’apport des <strong>méthodes de ré-échantillonnage est discutable</strong> sur cet exemple. On remarque en effet les algorithmes appliqués sur les données brûtes (non ré-équilibrées) sont performants. Le ré-équilibrage peut néanmoins améliorer certains critères comme par exemple le balanced accuracy pour lequel les méthodes de sur-échantillonnage (random oversampling et smote) permettent d’améliorer.
</li>
</ul>
<p>
Nous terminons en présentant quelques résultats pour d’autres valeurs de seuil. En effet, nous avons ici calculer la plupart des critères en utilisant le seuil de 0.5 pour déduire les groupes prédits à partir des valeurs de score. Il est souvent intéressant de visualiser ces critères pour <strong>différentes valeurs de seuil</strong>, on utilise alors des grilles de score qui consistent à présenter les valeurs de critère en fonction des scores. Nous comparons ici les grilles de score de la méthode ridge appliquée sur les données brûtes et les données ré-échantillonnées par random oversampling et smote. Ces grilles peuvent aider l’utilisateur à choisir le seuil de prévision en fonction des objectifs métiers. On créé tout d’abord une fonction qui permettra d’obtenir les grilles de score :
</p>
</div>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="comp-algo.html#cb301-1"></a>grille.score &lt;-<span class="st"> </span><span class="cf">function</span>(score,<span class="dt">nom_algo=</span><span class="st">&quot;ridge&quot;</span>,<span class="dt">meth=</span><span class="st">&quot;norm&quot;</span>,<span class="dt">grille.seuil=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">by=</span><span class="fl">0.1</span>)){</span>
<span id="cb301-2"><a href="comp-algo.html#cb301-2"></a>  S &lt;-<span class="st"> </span>score <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(nom_algo<span class="op">==</span>algo <span class="op">&amp;</span><span class="st"> </span>meth<span class="op">==</span>meth)</span>
<span id="cb301-3"><a href="comp-algo.html#cb301-3"></a>  S1 &lt;-<span class="st"> </span>S</span>
<span id="cb301-4"><a href="comp-algo.html#cb301-4"></a>  pp &lt;-<span class="st"> </span><span class="kw">as.character</span>(grille.seuil)</span>
<span id="cb301-5"><a href="comp-algo.html#cb301-5"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(grille.seuil)){</span>
<span id="cb301-6"><a href="comp-algo.html#cb301-6"></a>    S1 &lt;-<span class="st"> </span>S1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="kw">as.numeric</span>(score<span class="op">&gt;</span>grille.seuil[i]))</span>
<span id="cb301-7"><a href="comp-algo.html#cb301-7"></a>    <span class="kw">names</span>(S1)[<span class="dv">5</span><span class="op">+</span>i] &lt;-<span class="st"> </span>pp[i]</span>
<span id="cb301-8"><a href="comp-algo.html#cb301-8"></a>  }</span>
<span id="cb301-9"><a href="comp-algo.html#cb301-9"></a>  S2 &lt;-<span class="st"> </span>S1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(<span class="dt">key=</span><span class="st">&quot;seuil&quot;</span>,<span class="dt">value=</span><span class="st">&quot;prev&quot;</span>,<span class="op">-</span>meth,<span class="op">-</span>obs,<span class="op">-</span>algo,<span class="op">-</span>score,<span class="op">-</span>prev) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-10"><a href="comp-algo.html#cb301-10"></a><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="op">-</span>meth,<span class="op">-</span>algo,<span class="op">-</span>score) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-11"><a href="comp-algo.html#cb301-11"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">prev=</span><span class="kw">as.factor</span>(prev))</span>
<span id="cb301-12"><a href="comp-algo.html#cb301-12"></a>  mat.res &lt;-<span class="st"> </span>S2 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(seuil) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb301-13"><a href="comp-algo.html#cb301-13"></a><span class="st">    </span><span class="kw">summarize</span>(<span class="dt">sens=</span><span class="kw">sensitivity</span>(prev,obs),<span class="dt">spec=</span><span class="kw">specificity</span>(prev,obs),<span class="dt">Acc=</span><span class="kw">mean</span>(obs<span class="op">==</span>prev),</span>
<span id="cb301-14"><a href="comp-algo.html#cb301-14"></a>              <span class="dt">bal.acc=</span><span class="kw">monba</span>(prev,obs),<span class="dt">F1=</span><span class="kw">monF1</span>(prev,obs),<span class="dt">kappa=</span><span class="kw">monkappa</span>(prev,obs))</span>
<span id="cb301-15"><a href="comp-algo.html#cb301-15"></a>  mat.res[,<span class="dv">2</span><span class="op">:</span><span class="dv">7</span>] &lt;-<span class="st"> </span><span class="kw">round</span>(mat.res[,<span class="dv">2</span><span class="op">:</span><span class="dv">7</span>],<span class="dv">3</span>)</span>
<span id="cb301-16"><a href="comp-algo.html#cb301-16"></a>  <span class="kw">return</span>(mat.res)</span>
<span id="cb301-17"><a href="comp-algo.html#cb301-17"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="comp-algo.html#cb302-1"></a><span class="kw">grille.score</span>(mat.score,<span class="dt">nom_algo=</span><span class="st">&quot;ridge&quot;</span>,<span class="dt">meth=</span><span class="st">&quot;norm&quot;</span>)</span>
<span id="cb302-2"><a href="comp-algo.html#cb302-2"></a><span class="co"># A tibble: 11 x 7</span></span>
<span id="cb302-3"><a href="comp-algo.html#cb302-3"></a>   seuil  sens  spec   Acc bal.acc     F1 kappa</span>
<span id="cb302-4"><a href="comp-algo.html#cb302-4"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb302-5"><a href="comp-algo.html#cb302-5"></a><span class="st"> </span><span class="dv">1</span> <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">1</span>     <span class="fl">0.14</span>    <span class="fl">0.5</span>    <span class="fl">0.246</span> <span class="dv">0</span>    </span>
<span id="cb302-6"><a href="comp-algo.html#cb302-6"></a> <span class="dv">2</span> <span class="fl">0.1</span>   <span class="fl">0.671</span> <span class="fl">0.955</span> <span class="fl">0.711</span>   <span class="fl">0.813</span>  <span class="fl">0.48</span>  <span class="fl">0.343</span></span>
<span id="cb302-7"><a href="comp-algo.html#cb302-7"></a> <span class="dv">3</span> <span class="fl">0.2</span>   <span class="fl">0.745</span> <span class="fl">0.932</span> <span class="fl">0.771</span>   <span class="fl">0.839</span>  <span class="fl">0.533</span> <span class="fl">0.416</span></span>
<span id="cb302-8"><a href="comp-algo.html#cb302-8"></a> <span class="dv">4</span> <span class="fl">0.3</span>   <span class="fl">0.851</span> <span class="fl">0.911</span> <span class="fl">0.86</span>    <span class="fl">0.881</span>  <span class="fl">0.645</span> <span class="fl">0.566</span></span>
<span id="cb302-9"><a href="comp-algo.html#cb302-9"></a> <span class="dv">5</span> <span class="fl">0.4</span>   <span class="fl">0.918</span> <span class="fl">0.885</span> <span class="fl">0.913</span>   <span class="fl">0.901</span>  <span class="fl">0.74</span>  <span class="fl">0.69</span> </span>
<span id="cb302-10"><a href="comp-algo.html#cb302-10"></a> <span class="dv">6</span> <span class="fl">0.5</span>   <span class="fl">0.983</span> <span class="fl">0.843</span> <span class="fl">0.964</span>   <span class="fl">0.913</span>  <span class="fl">0.867</span> <span class="fl">0.846</span></span>
<span id="cb302-11"><a href="comp-algo.html#cb302-11"></a> <span class="dv">7</span> <span class="fl">0.6</span>   <span class="fl">0.991</span> <span class="fl">0.797</span> <span class="fl">0.964</span>   <span class="fl">0.894</span>  <span class="fl">0.861</span> <span class="fl">0.841</span></span>
<span id="cb302-12"><a href="comp-algo.html#cb302-12"></a> <span class="dv">8</span> <span class="fl">0.7</span>   <span class="fl">0.995</span> <span class="fl">0.739</span> <span class="fl">0.959</span>   <span class="fl">0.867</span>  <span class="fl">0.834</span> <span class="fl">0.811</span></span>
<span id="cb302-13"><a href="comp-algo.html#cb302-13"></a> <span class="dv">9</span> <span class="fl">0.8</span>   <span class="fl">0.997</span> <span class="fl">0.672</span> <span class="fl">0.952</span>   <span class="fl">0.835</span>  <span class="fl">0.796</span> <span class="fl">0.77</span> </span>
<span id="cb302-14"><a href="comp-algo.html#cb302-14"></a><span class="dv">10</span> <span class="fl">0.9</span>   <span class="fl">0.999</span> <span class="fl">0.562</span> <span class="fl">0.938</span>   <span class="fl">0.78</span>   <span class="fl">0.717</span> <span class="fl">0.685</span></span>
<span id="cb302-15"><a href="comp-algo.html#cb302-15"></a><span class="dv">11</span> <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span>     <span class="fl">0.86</span>    <span class="fl">0.5</span>   <span class="ot">NA</span>     <span class="dv">0</span>    </span>
<span id="cb302-16"><a href="comp-algo.html#cb302-16"></a><span class="kw">grille.score</span>(mat.score,<span class="dt">nom_algo=</span><span class="st">&quot;ridge&quot;</span>,<span class="dt">meth=</span><span class="st">&quot;over&quot;</span>)</span>
<span id="cb302-17"><a href="comp-algo.html#cb302-17"></a><span class="co"># A tibble: 11 x 7</span></span>
<span id="cb302-18"><a href="comp-algo.html#cb302-18"></a>   seuil  sens  spec   Acc bal.acc     F1 kappa</span>
<span id="cb302-19"><a href="comp-algo.html#cb302-19"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb302-20"><a href="comp-algo.html#cb302-20"></a><span class="st"> </span><span class="dv">1</span> <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">1</span>     <span class="fl">0.14</span>    <span class="fl">0.5</span>    <span class="fl">0.246</span> <span class="dv">0</span>    </span>
<span id="cb302-21"><a href="comp-algo.html#cb302-21"></a> <span class="dv">2</span> <span class="fl">0.1</span>   <span class="fl">0.671</span> <span class="fl">0.955</span> <span class="fl">0.711</span>   <span class="fl">0.813</span>  <span class="fl">0.48</span>  <span class="fl">0.343</span></span>
<span id="cb302-22"><a href="comp-algo.html#cb302-22"></a> <span class="dv">3</span> <span class="fl">0.2</span>   <span class="fl">0.745</span> <span class="fl">0.932</span> <span class="fl">0.771</span>   <span class="fl">0.839</span>  <span class="fl">0.533</span> <span class="fl">0.416</span></span>
<span id="cb302-23"><a href="comp-algo.html#cb302-23"></a> <span class="dv">4</span> <span class="fl">0.3</span>   <span class="fl">0.851</span> <span class="fl">0.911</span> <span class="fl">0.86</span>    <span class="fl">0.881</span>  <span class="fl">0.645</span> <span class="fl">0.566</span></span>
<span id="cb302-24"><a href="comp-algo.html#cb302-24"></a> <span class="dv">5</span> <span class="fl">0.4</span>   <span class="fl">0.918</span> <span class="fl">0.885</span> <span class="fl">0.913</span>   <span class="fl">0.901</span>  <span class="fl">0.74</span>  <span class="fl">0.69</span> </span>
<span id="cb302-25"><a href="comp-algo.html#cb302-25"></a> <span class="dv">6</span> <span class="fl">0.5</span>   <span class="fl">0.983</span> <span class="fl">0.843</span> <span class="fl">0.964</span>   <span class="fl">0.913</span>  <span class="fl">0.867</span> <span class="fl">0.846</span></span>
<span id="cb302-26"><a href="comp-algo.html#cb302-26"></a> <span class="dv">7</span> <span class="fl">0.6</span>   <span class="fl">0.991</span> <span class="fl">0.797</span> <span class="fl">0.964</span>   <span class="fl">0.894</span>  <span class="fl">0.861</span> <span class="fl">0.841</span></span>
<span id="cb302-27"><a href="comp-algo.html#cb302-27"></a> <span class="dv">8</span> <span class="fl">0.7</span>   <span class="fl">0.995</span> <span class="fl">0.739</span> <span class="fl">0.959</span>   <span class="fl">0.867</span>  <span class="fl">0.834</span> <span class="fl">0.811</span></span>
<span id="cb302-28"><a href="comp-algo.html#cb302-28"></a> <span class="dv">9</span> <span class="fl">0.8</span>   <span class="fl">0.997</span> <span class="fl">0.672</span> <span class="fl">0.952</span>   <span class="fl">0.835</span>  <span class="fl">0.796</span> <span class="fl">0.77</span> </span>
<span id="cb302-29"><a href="comp-algo.html#cb302-29"></a><span class="dv">10</span> <span class="fl">0.9</span>   <span class="fl">0.999</span> <span class="fl">0.562</span> <span class="fl">0.938</span>   <span class="fl">0.78</span>   <span class="fl">0.717</span> <span class="fl">0.685</span></span>
<span id="cb302-30"><a href="comp-algo.html#cb302-30"></a><span class="dv">11</span> <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span>     <span class="fl">0.86</span>    <span class="fl">0.5</span>   <span class="ot">NA</span>     <span class="dv">0</span>    </span>
<span id="cb302-31"><a href="comp-algo.html#cb302-31"></a><span class="kw">grille.score</span>(mat.score,<span class="dt">nom_algo=</span><span class="st">&quot;ridge&quot;</span>,<span class="dt">meth=</span><span class="st">&quot;smote&quot;</span>)</span>
<span id="cb302-32"><a href="comp-algo.html#cb302-32"></a><span class="co"># A tibble: 11 x 7</span></span>
<span id="cb302-33"><a href="comp-algo.html#cb302-33"></a>   seuil  sens  spec   Acc bal.acc     F1 kappa</span>
<span id="cb302-34"><a href="comp-algo.html#cb302-34"></a>   <span class="op">&lt;</span>chr<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">   </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st">  </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span><span class="st"> </span><span class="er">&lt;</span>dbl<span class="op">&gt;</span></span>
<span id="cb302-35"><a href="comp-algo.html#cb302-35"></a><span class="st"> </span><span class="dv">1</span> <span class="dv">0</span>     <span class="dv">0</span>     <span class="dv">1</span>     <span class="fl">0.14</span>    <span class="fl">0.5</span>    <span class="fl">0.246</span> <span class="dv">0</span>    </span>
<span id="cb302-36"><a href="comp-algo.html#cb302-36"></a> <span class="dv">2</span> <span class="fl">0.1</span>   <span class="fl">0.671</span> <span class="fl">0.955</span> <span class="fl">0.711</span>   <span class="fl">0.813</span>  <span class="fl">0.48</span>  <span class="fl">0.343</span></span>
<span id="cb302-37"><a href="comp-algo.html#cb302-37"></a> <span class="dv">3</span> <span class="fl">0.2</span>   <span class="fl">0.745</span> <span class="fl">0.932</span> <span class="fl">0.771</span>   <span class="fl">0.839</span>  <span class="fl">0.533</span> <span class="fl">0.416</span></span>
<span id="cb302-38"><a href="comp-algo.html#cb302-38"></a> <span class="dv">4</span> <span class="fl">0.3</span>   <span class="fl">0.851</span> <span class="fl">0.911</span> <span class="fl">0.86</span>    <span class="fl">0.881</span>  <span class="fl">0.645</span> <span class="fl">0.566</span></span>
<span id="cb302-39"><a href="comp-algo.html#cb302-39"></a> <span class="dv">5</span> <span class="fl">0.4</span>   <span class="fl">0.918</span> <span class="fl">0.885</span> <span class="fl">0.913</span>   <span class="fl">0.901</span>  <span class="fl">0.74</span>  <span class="fl">0.69</span> </span>
<span id="cb302-40"><a href="comp-algo.html#cb302-40"></a> <span class="dv">6</span> <span class="fl">0.5</span>   <span class="fl">0.983</span> <span class="fl">0.843</span> <span class="fl">0.964</span>   <span class="fl">0.913</span>  <span class="fl">0.867</span> <span class="fl">0.846</span></span>
<span id="cb302-41"><a href="comp-algo.html#cb302-41"></a> <span class="dv">7</span> <span class="fl">0.6</span>   <span class="fl">0.991</span> <span class="fl">0.797</span> <span class="fl">0.964</span>   <span class="fl">0.894</span>  <span class="fl">0.861</span> <span class="fl">0.841</span></span>
<span id="cb302-42"><a href="comp-algo.html#cb302-42"></a> <span class="dv">8</span> <span class="fl">0.7</span>   <span class="fl">0.995</span> <span class="fl">0.739</span> <span class="fl">0.959</span>   <span class="fl">0.867</span>  <span class="fl">0.834</span> <span class="fl">0.811</span></span>
<span id="cb302-43"><a href="comp-algo.html#cb302-43"></a> <span class="dv">9</span> <span class="fl">0.8</span>   <span class="fl">0.997</span> <span class="fl">0.672</span> <span class="fl">0.952</span>   <span class="fl">0.835</span>  <span class="fl">0.796</span> <span class="fl">0.77</span> </span>
<span id="cb302-44"><a href="comp-algo.html#cb302-44"></a><span class="dv">10</span> <span class="fl">0.9</span>   <span class="fl">0.999</span> <span class="fl">0.562</span> <span class="fl">0.938</span>   <span class="fl">0.78</span>   <span class="fl">0.717</span> <span class="fl">0.685</span></span>
<span id="cb302-45"><a href="comp-algo.html#cb302-45"></a><span class="dv">11</span> <span class="dv">1</span>     <span class="dv">1</span>     <span class="dv">0</span>     <span class="fl">0.86</span>    <span class="fl">0.5</span>   <span class="ot">NA</span>     <span class="dv">0</span>    </span></code></pre></div>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="dondes.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="références.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["TUTO_ML.pdf"],
"toc": {
"collapse": "subsection",
"sharing": {
"facebook": true,
"github": true,
"twitter": true
}
},
"highlight": "tango"
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
